MSA로 서비스 단위로 프로젝트를 분리하고 DB까지 분리를 하면 특정 DB의 변경을 다른 DB로 변경을 전파해야하는 경우가 발생한다.
- 주문 완료 -> 배송 요청
- 로그인 실패 -> 이상 탐지 발송

## 전파 방법

아래는 큰 관점에서의 대표적인 2가지 전파 방법이다.
- API 호출
- MQ로 데이터 전달
  
위 방법들은 N개의 시스템 간 Transaction 연동을 어떻게 할 지의 고민이 있다.

다른 방법으로 CDC를 사용할 수 있다.

## CDC

CDC(Change Data Capture)는 데이터 변경을 추적/식별하는 기법을 말하고, 데이터 통합에서 주로 사용한다.

Oracle의 GoldenGate나 MySQL의 Binlog가 이에 해당한다.

## CDC 구현

CDC 구현은 크게 2가지 패턴이 있다.
- DB의 변경 -> CDC -> 타 DB에 전파
- DB의 변경 -> CDC -> MQ Producer -> MQ Consumer -> 타 DB에 전파

CDC의 전파 데이터 기준은 아래 두 가지가 있다.
- 테이블 단위로 변경 전파
  - 구현이 단순
- 모델(N개의 테이블) 단위로 변경 전파
  - 구현이 복잡 

## 트랜잭션을 보장하는 기법

당연하지만 CDC를 사용해도 트랜잭션 보장하기 쉽지 않다. 트랜잭션을 보장하기 위해서는 아래의 방법이 있다.

#### 1. 후보정

CDC의 변경 전파가 실패했을 때 무시한 후 나중에 후보정하는 형태를 말한다.

#### 2. 중지

CDC의 변경 전파가 실패했을 때 수리를 먼저 한 후 다음에 재개하는 방식이다.

## CDC가 적합한 경우

1. 비동기로 변경을 전파해야할 때
2. 기존 코드의 변경없이 작업을 이뤄내고 싶을 때

## 예시

구현 예시는 아래와 같다.

사용자 -> CDC -> 관리
- 오류는 Sentry를 통해 수집/통지
- 수동 동기화 기능 추가

## 참고

- https://www.youtube.com/watch?v=n3ZgyfRoKDQ&t=62s